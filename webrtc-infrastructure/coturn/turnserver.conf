# Coturn TURN/STUN Server Configuration
# Optimized for high-performance WebRTC NAT traversal

# Network interfaces
# Will be configured dynamically based on container/VM IP
listening-ip=0.0.0.0
# External IP will be set via environment variable
# external-ip=$EXTERNAL_IP

# Ports
listening-port=3478
tls-listening-port=5349
# Alternative ports for restrictive networks
alt-listening-port=8080
alt-tls-listening-port=8443

# Relay endpoints
min-port=49152
max-port=65535

# Authentication
use-auth-secret
# Secret will be set via environment variable for security
# static-auth-secret=$TURN_SECRET

# Realm
realm=webrtc.example.com

# Performance and scalability
# Support for thousands of connections
total-quota=0
bps-capacity=0
max-allocate-lifetime=3600
stale-nonce=600
max-allocate-timeout=60

# Threading and performance
# Adjust based on CPU cores
relay-threads=4
# relay-threads=$RELAY_THREADS

# Security
no-loopback-peers
no-multicast-peers
secure-stun

# Logging
log-file=stdout
verbose
# Fingerprinting protection
fingerprint

# SSL/TLS Configuration
# Certificates will be mounted as volumes
# cert=/etc/coturn/certs/cert.pem
# pkey=/etc/coturn/certs/privkey.pem
# cipher-list="ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384"
# dh-file=/etc/coturn/dhparam.pem

# Database (optional, for persistent state)
# userdb=/var/lib/coturn/turndb
# psql-userdb="host=<dbhost> dbname=coturn user=coturn password=<dbpassword> connect_timeout=30"

# Prometheus metrics
# prometheus

# Rate limiting
user-quota=100
total-quota=1000

# Keep-alive
stun-only
no-stun=0

# CLI
# cli-ip=127.0.0.1
# cli-port=5766
# cli-password=$CLI_PASSWORD

# Additional security options
denied-peer-ip=0.0.0.0-0.255.255.255
denied-peer-ip=127.0.0.0-127.255.255.255
denied-peer-ip=::1
allowed-peer-ip=172.16.0.0-172.31.255.255
allowed-peer-ip=192.168.0.0-192.168.255.255
allowed-peer-ip=10.0.0.0-10.255.255.255

# WebRTC-specific optimizations
mobility
keep-address-family
no-tlsv1
no-tlsv1_1